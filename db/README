# Local setup

Tasks to help with dropping and recreating, then repopulating the db during development are in `tasks.py`

Tasks can be run locally and in container

- To run locally, make sure `psql` client is installed on your machine(https://www.postgresql.org/download/) & set the environment variable `DATABASE_URL`,
```bash
export DATABASE_URL=postgresql://postgres:password@127.0.0.1:5432/fund_store
```

- To run the tasks in the container, bash into the container
```bash
docker exec -it <container_id> bash
```

1. To recreate the db instance, run

        inv recreate-local-db

    this drops and recreates the DB
1. To re-initialise the flask db migrations, run

        inv init-migr
1. Once the initial migration version is created, update that python file (`db/migrations/xxxx_initial_migration.py`) to add required imports:

        import sqlalchemy_utils
1. To perform the migrations on the db and seed data, run

        inv seed-db

    This runs the migrations and the sql scripts in `db/cof_sql`. Then runs some select statements to show result of inserts.
